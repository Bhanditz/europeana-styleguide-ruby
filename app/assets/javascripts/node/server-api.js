var http=require("http"),url=require("url"),fs=require("fs"),path=require("path"),port=process.env.PORT||3e3,dataGen=require("./EuHierarchyData2"),server=http.createServer(function(a,b){var c,d,e,f=url.parse(a.url).pathname;f.indexOf(".css")==f.length-4?f=".."+f:f.indexOf(".gif")==f.length-4?f=".."+f:f.indexOf(".png")==f.length-4?f=".."+f:f.indexOf("jquery")>-1?f="../../../.."+f:f.indexOf("EuHierarchyTools")>-1||f.indexOf(".js")==f.length-3&&(f=".."+f),c=path.join(process.cwd(),f),e=url.parse(a.url,!0).query,console.log("uri "+f),console.log("fileName "+c),console.log("params "+JSON.stringify(e)),d=c,c=c.split("/");var g=c.pop(),h=c.pop(),i=10,j=e.limit?e.limit:i;console.log("action "+g),console.log("record "+h),console.log("action "+typeof g+" - "+g==null);var k=function(a){for(var b=!1,c=[".html",".css",".js",".png",".gif"],d=0;d<c.length;d++)a.indexOf(c[d])==a.length-c[d].length&&(b=!0);return b};if(!g||k(g))return void fs.readFile(d,"binary",function(a,c){return a?(b.writeHead(500,{"Content-Type":"text/plain"}),b.write('Error reading file "'+d+'":<br/>, uri: '+f+", params: "+JSON.stringify(e)),b.write(a+"\n"),void b.end()):(b.write(c,"binary"),void b.end())});var l=dataGen.search(h,g,j);l.success=!0,b.setHeader("Access-Control-Allow-Origin","*"),b.setHeader("Access-Control-Allow-Methods","GET,PUT,POST,DELETE,OPTIONS"),b.setHeader("Access-Control-Allow-Headers","Content-Type, Authorization, Content-Length, X-Requested-With"),b.writeHead(200,{"Content-Type":"application/json"}),b.write(JSON.stringify(l)),b.end()}).listen(port);console.log("Server running on port "+server.address().port);